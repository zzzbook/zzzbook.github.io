---
layout: post
title: 动手学深度学习v2-04 数据操作+数据预处理
date: 2021-12-28
categories: 动手学深度学习v2
tags: 研究生 深度学习

---

# 动手学深度学习v2-04 数据操作+数据预处理

- 视频参考：[04 数据操作 + 数据预处理【动手学深度学习v2】](https://www.bilibili.com/video/BV1CV411Y7i4?p=2)

## 基础数据操作

- 生成张量

  ```python
  import torch
  torch.arange(12)		# 顺序生成元素个数张量
  torch.zeros((2,3,4))	# 生成元素为 0 的多维张量
  torch.ones((2,3,4))		# 生成元素为 1 的多维张量
  torch.tensor([[2,1,4,3],[1,2,3,4],[4,3,2,1]])	#生成自定义元素张量
  ```
  
  <img src="http://markdown.zzzbook.cn/image-20211228165040965.png" alt="image-20211228165040965" style="zoom: 67%;" />
  
- 张量基础操作

  - 获取每个维度大小：`x.shape`
  - 获取元素总个数：`x.numel()`
  - 元素求和：`x.sum()`
  - 多维度分组：`x.reshape(3,4)`

- 数据选择

  ```python
  X = torch.arange(12, dtype=torch.float32).reshape((3,4))
  X[:]			# 输出全部
  X[1:]			# 1行之后全部
  X[1: , 1:3]		# 1行之后全部,1-3列
  X[1: , 0::2]	# 1行之后全部,0列起每隔2列
  ```

  <img src="http://markdown.zzzbook.cn/image-20211228165126548.png" alt="image-20211228165126548" style="zoom:67%;" />

- 张量维度合并

  ```python
  X = torch.arange(24, dtype=torch.float32).reshape((2,3,4))
  Y = torch.tensor([[[2,1,4,3],[1,2,3,4],[4,3,2,1]],[[2,1,4,3],[1,2,3,4],[4,3,2,1]]])
  torch.cat((X,Y), dim=0), torch.cat((X,Y), dim=1), torch.cat((X,Y), dim=2)	# 张量维度合并
  ```
  
  <img src="http://markdown.zzzbook.cn/image-20211228165206134.png" alt="image-20211228165206134" style="zoom:67%;" /><img src="http://markdown.zzzbook.cn/image-20211228165216496.png" alt="image-20211228165216496" style="zoom:67%;" /><img src="http://markdown.zzzbook.cn/image-20211228165229463.png" alt="image-20211228165229463" style="zoom:67%;" />
  
- 对应元素计算

  ```python
  x = torch.tensor([1,2,4,8])
  y = torch.tensor([2,2,2,2])
  x+y, x-y, x*y, x/y, x**y, x==y, torch.exp(x)
  ```
  
  <img src="http://markdown.zzzbook.cn/image-20211228165259888.png" alt="image-20211228165259888" style="zoom:67%;" />
  
- 广播机制

  ```python
  a = torch.arange(3).reshape((3,1)) # 当张量维度相同，结构不同，则广播机制会将元素复制为相同行列个数，进行运算
  b = torch.arange(2).reshape((1,2))
  a, b, a+b
  ```
  
  <img src="http://markdown.zzzbook.cn/image-20211228165326683.png" alt="image-20211228165326683" style="zoom:67%;" />

- 内存管理

  ```python
  X = torch.arange(12).reshape((3,4))
  Y = torch.arange(12).reshape((3,4))
  
  before = id(Y)	# 获取 Y 的地址
  Y[:] = Y + X	# 计算结果 Y + X 每个元素对应结果，赋值给对应元素，地址不变
  print(id(Y) == before)
  Y += X			# 将 X 直接加入 Y，地址不变
  print(id(Y) == before)
  Y = Y + X		# 将 X 于 Y 相加，重新赋值给 Y，地址变化
  print(id(Y) == before)
  # True True False
  ```

- 数据类型转换

  ```python
  A = X.numpy()
  B = torch.tensor(A)
  type(A), type(B)
  # (numpy.ndarray, torch.Tensor)
  
  a = torch.tensor([3.5])	# 大小为1的张量转换为 Python 标量
  a, a.item(), float(a), int(a)
  # (tensor([3.5000]), 3.5, 3.5, 3)
  ```

## 数据预处理

1. 生成数据集

   ```python
   import os
   os.makedirs(os.path.join('data'), exist_ok=True)	# 创建目录，若exist_ok=False（默认），则创建目录存在时抛出异常
   data_file = os.path.join('data','house_tiny.csv')
   with open(data_file, 'w') as f:		# 打开文件并写入数据
       f.write('NumRooms,Alley,Price\n')
       f.write('NA,Pave,127500\n')
       f.write('2,NA,106000\n')
       f.write('4,NA,178100\n')
       f.write('NA,NA,140000\n')
   ```

2. 读取 csv 数据

   ```python
   import pandas as pd
   data = pd.read_csv(data_file)
   ```

   <img src="http://markdown.zzzbook.cn/image-20211228163421612.png" alt="image-20211228163421612" style="zoom:67%;" />

3. 分组数据（输出组、输入组）

   ```python
   inputs, outputs = data.iloc[:, 0:2], data.iloc[:, 2]
   ```

   <img src="http://markdown.zzzbook.cn/image-20211228164215125.png" alt="image-20211228164215125" style="zoom:67%;" />

4. 填补空值数据

   ```python
   inputs = inputs.fillna(inputs.mean())	# 填补空值数据为样本均值（mean）
   # 文本型数据将不同数据内容拆分为多列标题，相同标记1，不同为0；dummy_na=False（默认），则添加空列（NaN）
   inputs = pd.get_dummies(inputs, dummy_na=True)
   ```

   <img src="http://markdown.zzzbook.cn/image-20211228164800454.png" alt="image-20211228164800454" style="zoom:67%;" />

5. 转换为 torch 数据类型

   ```python
   import torch
   x, y = torch.tensor(inputs.values), torch.tensor(outputs)
   ```

   <img src="http://markdown.zzzbook.cn/image-20211228164842511.png" alt="image-20211228164842511" style="zoom:67%;" />

